<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no"/>-->
    <meta name="viewport" content="width=1024" />
    <!--[if lt IE 9]>
      <script src="//n.sinaimg.cn/lib/common/html5shiv-printshiv.min.js"></script>
    <![endif]-->
    <meta name="keywords" content="赛车,F1,中国赛车,国际赛车,汽车运动,汽车产业" />
    <meta name="description" content="赛车,F1,中国赛车,国际赛车,汽车运动,汽车产业" />
    <link rel=”icon” href='./favicon.ico' mce_href=”/dir/favicon.ico” type=”image/x-icon”>
    <title>中国赛车</title>

    <link rel="stylesheet" href="./style/normalize.css" />
    <link rel="stylesheet" href="./lib/zui/css/zui.min.css" />
    <link rel="stylesheet" href="./style/dialog.css" />
    <script src="./js/jquery1.9.0.min.js"></script>
    <script src="./js/dialog.js"></script>
    <script src="./lib/zui/js/zui.min.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/common.js"></script>

    <!-- 样式文件 -->
    <!-- <link rel="stylesheet/less" type="text/css" href="./style/header.less" />
    <link rel="stylesheet/less" type="text/css" href="./style/profile.less" />
    <script src="./style/less.min.js"></script> -->

    <link rel="stylesheet" href="./style/header.css">
    <link rel="stylesheet" href="./style/profile.css">
</head>

<body>
    <nav class="navbar nav-header" role="navigation">
        <div class="container-fluid">
            <div class="nav-wrapper">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse-example">
                        <span class="sr-only">切换导航</span>
                    </button>
                    <a class="navbar-brand logo" href="./index.html"></a>
                </div>
                <div class="collapse navbar-collapse navbar-collapse-example">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="./index.html">首页</a></li>
                        <li><a href="./blog.html">在线论坛</a></li>
                        <li><a href="./admin.html">后台系统</a></li>
                        <li class="login-no"><a href="./login.html">登录/注册</a></li>
                        <li class="login-ok none- dropdown">
                            <a href="your/nice/url" class="dropdown-toggle" data-toggle="dropdown"><span
                                    id="name"></span> <b class="caret"></b></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <a href="./profile.html">
                                        <i class="icon icon-user"></i> 个人中心
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a onclick="logOut()"> <i class="icon icon-signout"></i> 退出登录 </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    <div class="wrapper">
        <!-- 左侧固定菜单 -->
        <ul class="slide-container">
            <li class="slide-item" data-page="personal-box">
                <i class="icon icon-tx"></i> <span>个人信息</span>
                <i class="icon icon-left"></i>
            </li>
            <li class="slide-item" data-page="task-box">
                <i class="icon icon-renwu"></i> <span>我的任务</span>
                <i class="icon icon-left"></i>
            </li>
            <!-- <li class="slide-item slide-admin hide" data-page="user-box">
                <i class="icon icon-group"></i> <span>用户管理</span>
                <i class="icon icon-left"></i>
            </li> -->
            <li class="slide-item slide-admin hide" data-page="system-box">
                <i class="icon icon-cloud"></i> <span>任务系统</span>
                <i class="icon icon-left"></i>
            </li>
            <li class="slide-item slide-admin hide" data-page="car-box">
                <i class="icon icon-flag"></i> <span>车队管理</span>
                <i class="icon icon-left"></i>
            </li>
            <li class="slide-item slide-admin hide" data-page="articl-box">
                <i class="icon icon-book"></i> <span>首页管理</span>
                <i class="icon icon-left"></i>
            </li>
        </ul>
        <!-- 右侧内容区域 -->
        <div class="main-container">
            <!-- 个人信息 -->
            <div class="personal-box main-item">
                <div class="card">
                    <div class="user-item">
                        <span class="user-label">账户：</span>
                        <span class="desc" id="username">-</span>
                    </div>
                    <div class="user-item">
                        <span class="user-label">真实姓名：</span>
                        <span class="desc" id="realname">-</span>
                    </div>
                    <div class="user-item">
                        <span class="user-label">电话号码：</span>
                        <span class="desc" id="phone">-</span>
                    </div>
                    <div class="user-item">
                        <span class="user-label">更新时间：</span>
                        <span class="desc" id="create_time">-</span>
                    </div>
                    <div class="user-item">
                        <span class="user-label">获奖信息：</span>
                        <span class="desc" id="awardInfo">-</span>
                    </div>
                    <div class="user-item">
                        <span class="user-label">特长：</span>
                        <span class="desc" id="specialty">-</span>
                    </div>
                </div>
            </div>
            <!-- 我的任务 -->
            <div class="task-box main-item hide">
                <div class="card">
                    <table class="table table-striped table-bordered" align="center" cellspacing="0" cellpadding="0">
                        <thead>
                            <th width="100px">任务名称</th>
                            <th width="200px">任务描述</th>
                            <th width="100px">任务实现者</th>
                            <th width="100px">所属车队</th>
                            <th width="100px">创建时间</th>
                            <th width="100px">任务状态</th>
                            <th width="180px">操作</th>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 用户管理 admin权限 -->
            <div class="user-box main-item main-admin hide">
                <div class="add-wrapper">
                    <button class="btn btn-success btn-mini" onclick="showAddUserModal()">
                        <i class="icon icon-plus"></i>
                        添加用户
                    </button>
                </div>
                <div class="card">
                    <table class="table table-striped table-bordered" align="center" cellspacing="0" cellpadding="0">
                        <thead>
                            <th width="100px">账户</th>
                            <th width="130px">账户权限</th>
                            <th width="130px">真实姓名</th>
                            <th width="100px">所属车队</th>
                            <th width="100px">特长</th>
                            <th width="200px">获奖信息</th>
                            <th width="100px">创建时间</th>
                            <th width="120px">操作</th>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 任务系统 admin权限 -->
            <div class="system-box main-item main-admin hide">
                <div class="add-wrapper">
                    <button class="btn btn-success btn-mini" onclick="showAddTaskModal()">
                        <i class="icon icon-plus"></i>
                        新建任务
                    </button>
                </div>
                <div class="card">
                    <table class="table table-striped table-bordered" align="center" cellspacing="0" cellpadding="0">
                        <thead>
                            <th width="100px">任务名称</th>
                            <th width="200px">任务描述</th>
                            <th width="100px">任务实现者</th>
                            <th width="100px">所属车队</th>
                            <th width="100px">创建时间</th>
                            <th width="100px">任务状态</th>
                            <th width="180px">操作</th>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <div class="no_table hide">
                        <p>暂无记录</p>
                    </div>

                    <div id="sys-page" style="text-align: center">
                        <ul id="pageLimit1"></ul>
                    </div>
                </div>
            </div>
            <!-- 车队管理 admin权限 -->
            <div class="car-box main-item main-admin hide">
                <div class="card">
                    <div class="add-wrapper">
                        <button class="btn btn-success btn-mini" onclick="addTeamModal()">
                            <i class="icon icon-plus"></i>
                            新建车队
                        </button>
                    </div>
                    <table class="table table-striped table-bordered" align="center" cellspacing="0" cellpadding="0">
                        <thead>
                            <th width="100px">车队名称</th>
                            <th width="120px">车队队长</th>
                            <th width="200px">车队简介</th>
                            <th width="100px">车队所属</th>
                            <th width="120px">创建时间</th>
                            <th>操作</th>
                        </thead>
                        <tbody>
                            <tr>
                                <td>test</td>
                                <td>test</td>
                                <td>test</td>
                                <td>test</td>
                                <td>
                                    <button class="btn btn-danger plan_btn" onclick="showPlanModal()">
                                        <i class="icon icon-times"></i>删除
                                    </button>
                                    <button class="btn btn-primary plan_btn" onclick="showPlanModal()">
                                        <i class="icon icon-repeat"></i>编辑
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 首页管理 admin权限 -->
            <div class="articl-box main-item main-admin hide">
                <div class="card">
                    <div class="add-wrapper">
                        <button class="btn btn-success btn-mini" onclick="showAddArticModal()">
                            <i class="icon icon-plus"></i>
                            新建内容
                        </button>
                    </div>
                    <table class="table table-striped table-bordered" align="center" cellspacing="0" cellpadding="0">
                        <thead>
                            <th width="150px">类型</th>
                            <th width="150px">标题</th>
                            <th width="200px">内容</th>
                            <th width="100px">创建人</th>
                            <th width="120px">创建时间</th>
                            <th width="80px">操作</th>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="detail">@ 2021 中国赛车</div>
        <div class="tips">
            本网站仅做学习交流之用途，若有侵权，请及时与站主联系。
        </div>
    </footer>
    <!--  对话框 编辑任务 -->
    <div id="planModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span
                            class="sr-only">关闭</span></button>
                    <h4 id="modal_task_title" class="modal-title"></h4>
                </div>
                <div class="modal-body">
                    <form id="modal_task_form" class="form-horizontal">
                        <div class="form-group">
                            <label for="task_form_title" class="col-sm-2">任务名称</label>
                            <div class="col-sm-10">
                                <input name="title" type="text" class="form-control" id="task_form_title" placeholder="任务名称">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="task_form_content" class="col-sm-2">任务内容</label>
                            <div class="col-sm-10">
                                <textarea name="content" id="task_form_content" type="text" class="form-control" rows="5" placeholder="任务描述"></textarea>
                            </div>
                        </div>
                        <!-- <div class="form-group">
                            <label for="task_form_status" class="col-sm-2">任务状态</label>
                            <div class="col-sm-10">
                                <select name="status" class="form-control" id="task_form_status">
                                    <option label="请选择任务状态" value=""></option>
                                    <option label="待开始" value="1"></option>
                                    <option label="进行中" value="2"></option>
                                    <option label="已完成" value="3"></option>
                                </select>
                            </div>
                        </div> -->
                        <div class="form-group">
                            <label for="task_form_userId" class="col-sm-2">任务实现者</label>
                            <div class="col-sm-10">
                                <select name="userId" class="form-control" id="task_form_userId">
                                    <option label="请选择用户" value=""></option>
                                </select>
                            </div>
                        </div>
                        <!-- <div class="form-group">
                            <label for="task_form_teamId" class="col-sm-2">所属车队</label>
                            <div class="col-sm-10">
                                <select name="teamId" class="form-control" id="task_form_teamId">
                                    <option label="请选择车队" value=""></option>
                                </select>
                            </div>
                        </div> -->
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="editTask(this)">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 确认弹窗 -->
    <div class="modal fade" id="confirm_Modal">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span
                            class="sr-only">关闭</span></button>
                    <h4 class="modal-title" id="confirm_Modal_title"></h4>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" onclick="confirmModalSubmit(this)">确认</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 对话框 编辑 用户 -->
    <div id="userModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span
                            class="sr-only">关闭</span></button>
                    <h4 id="modal_user_title" class="modal-title"></h4>
                </div>
                <div class="modal-body">
                    <form id="modal_user_form" class="form-horizontal">
                        <div class="form-group">
                            <label for="user_form_username" class="col-sm-2">账户名称</label>
                            <div class="col-sm-10">
                                <input name="username" type="text" class="form-control" id="user_form_username" placeholder="账户名称">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_realname" class="col-sm-2">真实姓名</label>
                            <div class="col-sm-10">
                                <input name="realName" id="user_form_realname" type="text" class="form-control" placeholder="真实姓名"></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_superAdmin" class="col-sm-2">账户权限</label>
                            <div class="col-sm-10">
                                <select name="superAdmin" class="form-control" id="user_form_superAdmin">
                                    <option label="请选择账户权限" value=""></option>
                                    <option label="普通用户" value="0"></option>
                                    <option label="超级管理员" value="1"></option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_phone" class="col-sm-2">电话号码</label>
                            <div class="col-sm-10">
                                <input name="phone" id="user_form_phone" type="text" class="form-control" placeholder="电话号码"></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_specialty" class="col-sm-2">特长</label>
                            <div class="col-sm-10">
                                <input name="specialty" id="user_form_specialty" type="text" class="form-control" placeholder="特长"></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_awardInfo" class="col-sm-2">获奖信息</label>
                            <div class="col-sm-10">
                                <textarea name="awardInfo" id="user_form_awardInfo" type="text" class="form-control" rows="5" placeholder="获奖信息"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_teamId" class="col-sm-2">所属车队</label>
                            <div class="col-sm-10">
                                <select name="teamId" class="form-control" id="user_form_teamId">
                                    <option label="请选择车队" value=""></option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="editUserModalSubmit(this)">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 对话框 添加 用户 -->
    <div id="userAddModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span
                            class="sr-only">关闭</span></button>
                    <h4 id="modal_user_title" class="modal-title"></h4>
                </div>
                <div class="modal-body">
                    <form id="modal_user_add_form" class="form-horizontal">
                        <div class="form-group">
                            <label for="user_form_username" class="col-sm-2">账户</label>
                            <div class="col-sm-10">
                                <input name="username" type="text" class="form-control" id="user_form_username" placeholder="账户">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_realname" class="col-sm-2">真实姓名</label>
                            <div class="col-sm-10">
                                <input name="realName" id="user_form_realname" type="text" class="form-control" placeholder="真实姓名"></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_superAdmin" class="col-sm-2">账户权限</label>
                            <div class="col-sm-10">
                                <select name="superAdmin" class="form-control" id="user_form_superAdmin">
                                    <option label="请选择账户权限" value=""></option>
                                    <option label="普通用户" value="0"></option>
                                    <option label="超级管理员" value="1"></option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_password" class="col-sm-2">初始密码</label>
                            <div class="col-sm-10">
                                <input name="password" id="user_form_password" type="text" class="form-control" placeholder="初始密码"></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_phone" class="col-sm-2">电话号码</label>
                            <div class="col-sm-10">
                                <input name="phone" id="user_form_phone" type="text" class="form-control" placeholder="电话号码（可选）"></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_specialty" class="col-sm-2">特长</label>
                            <div class="col-sm-10">
                                <input name="specialty" id="user_form_specialty" type="text" class="form-control" placeholder="特长（可选）"></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_awardInfo" class="col-sm-2">获奖信息</label>
                            <div class="col-sm-10">
                                <textarea name="awardInfo" id="user_form_awardInfo" type="text" class="form-control" rows="5" placeholder="获奖信息（可选）"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_teamId" class="col-sm-2">所属车队</label>
                            <div class="col-sm-10">
                                <select name="teamId" class="form-control" id="user_form_teamId">
                                    <option label="请选择车队" value=""></option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="addUserModalSubmit(this)">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 对话框 添加/编辑车队 -->
    <div id="teamModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span
                            class="sr-only">关闭</span></button>
                    <h4 id="modal_team_title" class="modal-title"></h4>
                </div>
                <div class="modal-body">
                    <form id="modal_team_form" class="form-horizontal">
                        <div class="form-group">
                            <label for="user_form_name" class="col-sm-2">车队名称</label>
                            <div class="col-sm-10">
                                <input name="name" type="text" class="form-control" id="user_form_name" placeholder="车队名称">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user_form_content" class="col-sm-2">车队简介</label>
                            <div class="col-sm-10">
                                <textarea name="content" id="user_form_content" type="text" class="form-control" placeholder="车队简介"></textarea>
                            </div>
                        </div>
                        <!-- <div class="form-group">
                            <label for="user_form_captain" class="col-sm-2">队长</label>
                            <div class="col-sm-10">
                                <select name="captain" class="form-control" id="user_form_captain">
                                    <option label="请选择队长" value=""></option>
                                </select>
                            </div>
                        </div> -->
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="editTeamModalSubmit(this)">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 对话框 添加/编辑首页文章 -->
    <div id="articlModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span
                            class="sr-only">关闭</span></button>
                    <h4 id="modal_articl_title" class="modal-title"></h4>
                </div>
                <div class="modal-body">
                    <form id="modal_articl_form" class="form-horizontal">
                        <div class="form-group">
                            <label for="articl_form_title" class="col-sm-2">标题</label>
                            <div class="col-sm-10">
                                <input name="title" type="text" class="form-control" id="articl_form_title" placeholder="请输入标题">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="articl_form_content" class="col-sm-2">内容</label>
                            <div class="col-sm-10">
                                <textarea name="content" id="articl_form_content" type="text" class="form-control" rows="8" placeholder="请输入内容"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="articl_form_type" class="col-sm-2">类型</label>
                            <div class="col-sm-10">
                                <select name="type" class="form-control" id="articl_form_type">
                                    <option label="请选择类型" value=""></option>
                                    <option label="通知" value=1></option>
                                    <option label="公告" value=2></option>
                                    <option label="赛事消息" value=3></option>
                                    <option label="新闻轮播" value=4></option>
                                    <option label="相关网址" value=5></option>
                                </select>
                            </div>
                        </div>
                        <!-- <div class="form-group articl_form_group_icon">
                            <label for="articl_form_icon" class="col-sm-2">图片地址</label>
                            <div class="col-sm-10">
                                <input name="icon" id="articl_form_icon" type="text" class="form-control" placeholder="请输入图片地址"></input>
                            </div>
                        </div>
                        <div class="form-group articl_form_group_url">
                            <label for="articl_form_url" class="col-sm-2">链接url</label>
                            <div class="col-sm-10">
                                <input name="url" id="articl_form_url" type="text" class="form-control" placeholder="请输入链接url"></input>
                            </div>
                        </div> -->
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="editArticlModalSubmit(this)">确定</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 页面事件 参数  类似vue-data写法
        var pageInfo = {
            handleType: null,
            handRow: null, // 当前操作行数据
            taskList: null, // 任务管理
            userList: null, // 用户管理
            teamList: null, // 车队管理 
            articlList: null, // 文章管理 
            myTaskList: null, //我的任务
            reViewList: null, //审核列表
            map_user: {},
            map_team: {},
            map_task: {},
            articlSelect: '', //首页文章选择类型
            articlTypes: {
                1: '通知',
                2: '公告',
                3: '赛事消息',
                4: '新闻轮播',
                5: '相关网址',
            }
        };
        window.onload = function() {
            init();
        };

        function init() {
            isLogin()
            getUserInfo()
            getAllList()
            initSlide();
            eventListener();
        }

        // 用户信息
        function getUserInfo() {
            $.ajax({
                type: 'get',
                url: baseUrl + '/user/' + localStorage.getItem('userid'),
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    localStorage.setItem('userInfo', data)
                    localStorage.setItem('role', data.superAdmin)
                    $('.personal-box #username').html(data.username)
                    $('.personal-box #realname').html(data.realName)
                    $('.personal-box #phone').html(data.phone)
                    $('.personal-box #create_time').html(data.createTime)
                    $('.personal-box #awardInfo').html(data.awardInfo)
                    $('.personal-box #specialty').html(data.specialty)
                        // 根据权限 决定是否展示 左侧菜单内容
                        // 超级管理员？
                    if (data.superAdmin) {
                        $('.wrapper .slide-container').find('.slide-admin').removeClass('hide')
                    } else {
                        $('.wrapper .slide-container').find('.slide-admin').addClass('hide')
                        $('.wrapper .slide-container').find('.slide-admin').remove()
                        $('.wrapper .main-container').find('.main-admin').remove()
                    }
                },
                error: function() {

                }
            })
        }

        // 嵌套ajax 获取用户列表/任务列表/车队列表/首页文章列表
        function getAllList() {
            // 用户列表
            try {
                $.ajax({
                    type: 'GET',
                    url: _apiUserList,
                    contentType: "application/json",
                    dataType: 'json',
                    xhrFields: {
                        withCredentials: true
                    },
                    crossDomain: true,
                    async: true,
                    success: function(userData) {
                        pageInfo.userList = userData
                            // 任务列表
                        $.ajax({
                            type: 'GET',
                            url: _apitaskList,
                            contentType: "application/json",
                            dataType: 'json',
                            xhrFields: {
                                withCredentials: true
                            },
                            crossDomain: true,
                            async: true,
                            success: function(taskData) {
                                pageInfo.taskList = taskData
                                    // 审核列表
                                $.ajax({
                                    type: 'get',
                                    url: _apiInfoReviewList,
                                    contentType: "application/json",
                                    dataType: 'json',
                                    xhrFields: {
                                        withCredentials: true
                                    },
                                    crossDomain: true,
                                    success: function(reviewData) {
                                        pageInfo.reViewList = reviewData
                                            // 车队列表
                                        $.ajax({
                                            type: 'GET',
                                            url: _apiTeamList,
                                            contentType: "application/json",
                                            dataType: 'json',
                                            xhrFields: {
                                                withCredentials: true
                                            },
                                            crossDomain: true,
                                            async: true,
                                            success: function(teamData) {
                                                pageInfo.teamList = teamData
                                                    // 首页文章列表
                                                $.ajax({
                                                    type: 'GET',
                                                    url: _apiInfoList,
                                                    contentType: "application/json",
                                                    dataType: 'json',
                                                    xhrFields: {
                                                        withCredentials: true
                                                    },
                                                    crossDomain: true,
                                                    async: true,
                                                    success: function(articData) {
                                                        pageInfo.articlList =
                                                            articData
                                                            // 渲染
                                                        setHtmlBox()
                                                    },
                                                    error: function(articData) {
                                                        throw new Error(
                                                            articData)
                                                    }
                                                })
                                            },
                                            error: function(teamData) {
                                                throw new Error(teamData)
                                            }
                                        })
                                    }
                                })
                            },
                            error: function(taskData) {
                                throw new Error(taskData)
                            }
                        })
                    },
                    error: function(userData) {
                        throw new Error(userData)
                    }
                })
            } catch (error) {
                const data = JSON.parse(e.responseText)
                showToast({
                    msg: '失败',
                    icon: 'times',
                    type: 'danger'
                })
            }
        }

        // 渲染界面
        function setHtmlBox() {
            let systemdomStr = '',
                sysData = pageInfo.taskList,
                teamdomStr = '',
                teamData = pageInfo.teamList,
                userdomStr = '',
                userData = pageInfo.userList,
                articldomStr = '',
                articlData = pageInfo.articlList;

            // 构建map映射
            // 用户id-名称
            var map_user = {}
                // 车队id-名称
            var map_team = {}
                // 任务id-名称
            var map_task = {}

            if (userData && userData.length) {
                userData.forEach(item => {
                    map_user[item.id] = item.username
                })
            }
            if (teamData && teamData.length) {
                teamData.forEach(item => {
                    map_team[item.id] = item.name
                })
            }
            if (sysData && sysData.length) {
                sysData.forEach(item => {
                    map_task[item.id] = item.title
                })
            }
            pageInfo.map_user = map_user
            pageInfo.map_team = map_team
            pageInfo.map_task = map_task
                // 找出 我的任务 
            var myTaskList = []
                // 用户列表
            if (userData && userData.length) {
                for (let i = 0; i < userData.length; i++) {
                    userdomStr += '<tr>' +
                        '                <td>' + userData[i].username + '</td>' +
                        '                <td>' + (userData[i].superAdmin ? '超级管理员' : '普通用户') + '</td>' +
                        '                <td>' + (userData[i].realName ? userData[i].realName : '') + '</td>' +
                        '                <td>' + (map_team[userData[i].teamId] ? map_team[userData[i].teamId] : '-') +
                        '</td>' +
                        '                <td>' + (userData[i].specialty ? userData[i].specialty : '-') + '</td>' +
                        '                <td>' + (userData[i].awardInfo ? userData[i].awardInfo : '-') + '</td>' +
                        '                <td>' + (userData[i].createTime ? userData[i].createTime : '-') + '</td>' +
                        '               <td>' +
                        '                    <button class="btn btn-danger plan_btn" data-index="' + i +
                        '" onclick="deleteUserModal(this)">' +
                        '                        <i class="icon icon-times"></i>删除' +
                        '                    </button>' +
                        '            <button class="btn btn-primary plan_btn" style="margin-top:10px" data-index="' +
                        i +
                        '" onclick="showUserModal(this)">' +
                        '                <i class="icon icon-repeat"></i>编辑' +
                        '        </button>' +
                        '    </td>' +
                        '</tr>'
                }
                $('.user-box table tbody').html(userdomStr)
            } else {
                $('.user-box table tbody').html('<tr><td colspan="5" align="center">暂无数据</td></tr>')
            }

            // 任务列表
            if (pageInfo.taskList && pageInfo.taskList.length) {
                for (let i = 0; i < sysData.length; i++) {
                    if (sysData[i].userId == localStorage.getItem('userid')) {
                        myTaskList.push(sysData[i])
                    }
                    let status = '',
                        statusStr = ''
                    if (sysData[i].status == 1) {
                        statusStr = '<span class="label label-warning">待开始</span>'
                    }
                    if (sysData[i].status == 2) {
                        statusStr = '<span class="label label-info">进行中</span>'
                    }
                    if (sysData[i].status == 3) {
                        statusStr = '<span class="label label-success">已完成</span>'
                    }

                    // 根据上面的映射 找出实现者 找出车队 就好做了
                    systemdomStr += '<tr>' +
                        '           <td>' + sysData[i].title + '</td>' +
                        '           <td>' + sysData[i].content + '</td>' +
                        '           <td>' + map_user[sysData[i].userId] + '</td>' +
                        '           <td>' + map_team[sysData[i].teamId] + '</td>' +
                        '           <td>' + sysData[i].createTime + '</td>' +
                        '           <td>' + statusStr + '</td>' +
                        '           <td>' +
                        '               <button class="btn btn-danger plan_btn"  data-index=' + i +
                        ' onclick="deletTask(this)">' +
                        '               <i class="icon icon-times"></i>删除' +
                        '       </button>' +
                        '       <button class="btn btn-primary plan_btn" style="margin-top:10px" data-index=' + i +
                        ' onclick="showPlanModal(this)">' +
                        '           <i class="icon icon-edit-sign"></i>编辑' +
                        '   </button>' +
                        '</td>' +
                        '</tr>'
                }
                $('.system-box table tbody').html(systemdomStr)
                pageInfo.myTaskList = myTaskList
            } else {
                $('.system-box table tbody').html('<tr><td colspan="7" align="center">暂无数据</td></tr>')
            }

            // 我的任务
            if (myTaskList && myTaskList.length) {
                var mytaskdomStr = ''
                for (let i = 0; i < myTaskList.length; i++) {
                    let mystatus = '',
                        mystatusStr = ''
                    if (myTaskList[i].status == 1) {
                        mystatusStr = '<span class="label label-warning">待开始</span>'
                    }
                    if (myTaskList[i].status == 2) {
                        mystatusStr = '<span class="label label-info">进行中</span>'
                    }
                    if (myTaskList[i].status == 3) {
                        mystatusStr = '<span class="label label-success">已完成</span>'
                    }

                    // 根据上面的映射 找出实现者 找出车队 就好做了
                    mytaskdomStr += '<tr>' +
                        '           <td>' + myTaskList[i].title + '</td>' +
                        '           <td>' + myTaskList[i].content + '</td>' +
                        '           <td>' + map_user[sysData[i].userId] + '</td>' +
                        '           <td>' + map_team[sysData[i].teamId] + '</td>' +
                        '           <td>' + myTaskList[i].createTime + '</td>' +
                        '           <td>' + mystatusStr + '</td>' +
                        '           <td>' +
                        '       <button class="btn btn-primary plan_btn" style="margin-top:10px" data-index=' + i +
                        ' onclick="showMyTaskMdoal(this)">' +
                        '           <i class="icon icon-edit-sign"></i>更新进度' +
                        '   </button>' +
                        '</td>' +
                        '</tr>'
                }
                $('.task-box table tbody').html(mytaskdomStr)
            } else {
                $('.task-box table tbody').html('<tr><td colspan="7" align="center">暂无数据</td></tr>')
            }

            // 车队列表
            if (teamData && teamData.length) {
                for (let i = 0; i < teamData.length; i++) {
                    console.log(pageInfo.reViewList)
                    var reviewid = -1,
                        btnStr = ' <button class="btn btn-info plan_btn" style="margin-top:10px" data-index="' + i +
                        '" onclick="joinTeamModal(this)">' +
                        ' <i class="icon icon-hand-left"></i>加入' +
                        '</button>'
                    if (pageInfo.reViewList && pageInfo.reViewList.length) {
                        reviewid = pageInfo.reViewList[0].teamId
                        if (reviewid == teamData[i].id) {
                            btnStr = '</button>' +
                                ' <button class="btn btn-warning plan_btn" style="margin-top:10px" data-index="' + i +
                                '" onclick="joinTeamModal(this)">' +
                                ' <i class="icon icon-hand-right"></i>退出' +
                                '  </button>'
                        }
                    }

                    teamdomStr += '<tr>' +
                        '                <td>' + teamData[i].name + '</td>' +
                        '                <td>' + map_user[teamData[i].captain] + '</td>' +
                        '                <td>' + teamData[i].content + '</td>' +
                        '                <td>' + map_user[teamData[i].createUser] + '</td>' +
                        '                <td>' + teamData[i].createTime + '</td>' +
                        '               <td>' +
                        '                    <button class="btn btn-danger plan_btn" data-index="' + i +
                        '" onclick="deleteTeamModal(this)">' +
                        '                        <i class="icon icon-times"></i>删除' +
                        '                    </button>' +
                        '            <button class="btn btn-primary plan_btn" style="margin-top:10px" data-index="' +
                        i +
                        '" onclick="showTeamModal(this)">' +
                        '                <i class="icon icon-repeat"></i>编辑' +
                        '        </button>' + btnStr +
                        '    </td>' +
                        '</tr>'
                }
                $('.car-box table tbody').html(teamdomStr)
            } else {
                $('.car-box table tbody').html('<tr><td colspan="6" align="center">暂无数据</td></tr>')
            }
            // 文章列表
            if (articlData && articlData.length) {
                for (let i = 0; i < articlData.length; i++) {
                    articldomStr += '<tr>' +
                        '                <td> <div class="ellipis-3">' + pageInfo.articlTypes[articlData[i].type] +
                        '</div></td>' +
                        '                <td> <div class="ellipis-3">' + articlData[i].title + '</div></td>' +
                        '                <td> <div class="ellipis-3">' + articlData[i].content + '</div></td>' +
                        '                <td> ' + map_user[articlData[i].createUser] + '</td>' +
                        '                <td>' + articlData[i].createTime + '</td>' +
                        '               <td>' +
                        '                    <button class="btn btn-danger plan_btn"  style="margin-top:10px" data-index="' +
                        i +
                        '" onclick="deleteArticlModal(this)">' +
                        '                        <i class="icon icon-times"></i>删除' +
                        '                    </button>' +
                        '            <button class="btn btn-primary plan_btn" style="margin-top:10px" data-index="' +
                        i +
                        '" onclick="showArticlModal(this)">' +
                        '                <i class="icon icon-repeat"></i>编辑' +
                        '        </button>' +
                        '    </td>' +
                        '</tr>'
                }
                $('.articl-box table tbody').html(articldomStr)
            } else {
                $('.articl-box table tbody').html('<tr><td colspan="6" align="center">暂无数据</td></tr>')
            }
        }

        // 左侧菜单
        function initSlide() {
            // 初始化 个人信息
            $(".slide-container")
                .children()
                .eq(0)
                .addClass("active")
                .siblings()
                .removeClass("active");
        }

        // 事件监听集合
        function eventListener() {
            // 菜单栏点击监听
            $(".slide-container").on("click", ".slide-item", function(e) {
                var $target = $(event.target || event.srcElement);
                while ($target.get(0).tagName.toLowerCase() != "li") {
                    $target = $target.parent();
                }
                if ($target.get(0).className.indexOf("active") != -1) return;
                $target.addClass("active").siblings().removeClass("active");
                var targetBox = $target.attr("data-page");
                // 展示对应的
                $(`.${targetBox}`).removeClass("hide").siblings().addClass("hide");
            });
            // 首页弹窗 类型选择
            $('#articlModal #articl_form_type').change(function() {
                var v = $(this).children('option:selected').val()
                pageInfo.articlSelect = v
                    // 4 新闻轮播
                    // 5 相关网址
                htmlAtrilFormItem(pageInfo)
            })
        }


        // 编辑任务
        function showPlanModal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.taskList[index]
            htmlTaskOption()
                // console.log(pageInfo.handRow)
            $('#planModal #modal_task_title').html('编辑任务')
            $('#planModal  #task_form_title').val(pageInfo.handRow.title)
            $('#planModal  #task_form_content').val(pageInfo.handRow.content)
            $('#planModal  #task_form_status').val(pageInfo.handRow.status)
            $('#planModal  #task_form_userId').val(pageInfo.handRow.userId)
            $('#planModal  #task_form_teamId').val(pageInfo.handRow.teamId)


            $('#planModal  #task_form_title').removeAttr('disabled')
            $('#planModal  #task_form_content').removeAttr('disabled')
            $('#planModal  #task_form_status').removeAttr('disabled')
            $('#planModal  #task_form_userId').removeAttr('disabled')
            $('#planModal  #task_form_teamId').removeAttr('disabled')

            pageInfo.handleType = 'EDITTASK'
            $('#planModal').modal()
        }
        // 编辑我的任务
        function showMyTaskMdoal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.myTaskList[index]
            htmlTaskOption()
                // console.log(pageInfo.handRow)
            $('#planModal #modal_task_title').html('编辑任务')
            $('#planModal  #task_form_title').val(pageInfo.handRow.title)
            $('#planModal  #task_form_content').val(pageInfo.handRow.content)
            $('#planModal  #task_form_status').val(pageInfo.handRow.status)
            $('#planModal  #task_form_userId').val(pageInfo.handRow.userId)
            $('#planModal  #task_form_teamId').val(pageInfo.handRow.teamId)

            $('#planModal  #task_form_title').attr('disabled', 'disabled')
            $('#planModal  #task_form_content').attr('disabled', 'disabled')
            $('#planModal  #task_form_userId').attr('disabled', 'disabled')
            $('#planModal  #task_form_teamId').attr('disabled', 'disabled')
            pageInfo.handleType = 'EDITTASK'
                // 进行禁用

            $('#planModal').modal()

        }

        // 添加任务
        function showAddTaskModal() {
            htmlTaskOption()
            $('#planModal #modal_task_title').html('添加任务')
            $('#planModal  #task_form_title').val('')
            $('#planModal  #task_form_content').val('')
            $('#planModal  #userId').val('')
            $('#planModal  #task_form_status').val('')
            pageInfo.handleType = 'ADDTASK'
            $('#planModal').modal()
        }
        // 删除任务
        function deletTask(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.taskList[index]
            $('#confirm_Modal #confirm_Modal_title').html('是否删除任务 ' + pageInfo.handRow.title + '?')
            pageInfo.handleType = 'DELETETASK'
            $('#confirm_Modal').modal()
        }


        // 弹窗确定
        function editTask(btn) {
            var $btn = $(this);
            var params = {};
            var form_data = $('#modal_task_form').serializeArray()
                // 数据查验
            try {
                form_data.forEach(item => {
                    if (item.name == 'title' && !item.value) {
                        throw new Error('请输入任务名称！')
                    }
                    if (item.name == 'content' && !item.value) {
                        throw new Error('请输入任务内容！')
                    }
                    if (item.name == 'status' && !item.value) {
                        throw new Error('请选择任务状态！')
                    }
                    if (item.name == 'userId' && !item.value) {
                        throw new Error('请选择任务实现者！')
                    }
                    if (item.name == 'teamId' && !item.value) {
                        throw new Error('请选择所属车队！')
                    }
                    params[item.name] = item.value
                })
                if (!localStorage.getItem('userid')) {
                    setTimeout(function() {
                        location.href = './login.html'
                    }, 1000)
                    throw new Error('登录失效请重新登录！')
                }
                params.createUser = localStorage.getItem('userid')
                params.createTime = new Date().getTime()

                handleAddTask($btn, params)
            } catch (data) {
                params = {}
                showToast({
                    msg: data + '' || '数据有误！',
                    icon: 'times',
                    type: 'danger'
                })
            }

        }

        // 添加/修改 任务业务事件
        function handleAddTask($btn, params) {
            $btn.button("loading");
            let url, type, msg;
            if (pageInfo.handleType == 'ADDTASK') {
                type = 'post'
                url = _apitaskAdd
                msg = "添加"
            } else {
                type = 'put'
                url = _apitaskUpdate
                msg = "修改"
                params.id = pageInfo.handRow.id
                params.createTime = null
            }
            // 执行添加操作
            $.ajax({
                type: type,
                url: url,
                data: JSON.stringify(params),
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                            msg: msg + '成功！',
                            icon: 'check',
                            type: 'success'
                        })
                        $('#planModal').modal('hide')
                        pageInfo.handleType = null
                        pageInfo.handRow = null
                            // 刷新列表
                        getAllList()

                    } else {
                        showToast({
                            msg: msg + '失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: msg + '失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })

        }
        // 删除任务业务事件
        function handleDeleteTask($btn, id) {
            $btn.button("loading");
            // 执行删除操作
            $.ajax({
                type: 'DELETE',
                url: _apitaskDelete + id,
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: '删除成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        getAllList()
                        $('#confirm_Modal').modal('hide')
                    } else {
                        showToast({
                            msg: '删除失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: '删除失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })

        }

        // 确认框 确认 
        function confirmModalSubmit(btn) {
            const $btn = $(btn)
            switch (pageInfo.handleType) {
                case 'DELETETASK':
                    // 删除任务
                    handleDeleteTask($btn, pageInfo.handRow.id)
                    break;
                case 'DELETEUSER':
                    // 删除用户
                    handleDeleteUser($btn, pageInfo.handRow.id)
                    break;
                case 'DELETETEAM':
                    // 删除车队
                    handleDeleteTeam($btn, pageInfo.handRow.id)
                    break;
                case 'DELETARTICL':
                    // 删除车队
                    handleDeleteArtic($btn, pageInfo.handRow.id)
                    break;
                case 'JOINTEAM':
                    // 加入车队
                    handleJoinTeam($btn, pageInfo.handRow.id)
                    break;
                case 'QUITTEAM':
                    // 退出车队
                    handleQuitTeam($btn, pageInfo.handRow.id)
                    break;

                default:
                    break;
            }
        }


        // select option
        function htmlTaskOption() {
            const data = pageInfo.userList
            if (data && data.length) {
                var domStr = '<option label="请选择用户" value=""></option>'
                for (let i = 0; i < data.length; i++) {
                    domStr += '<option label="' + data[i].username + '" value="' + data[i].id + '"></option>'
                }
                $('#planModal #task_form_userId').html(domStr)
            }
            const teamData = pageInfo.teamList
            if (teamData && teamData.length) {
                var domStr = ' <option label="请选择车队" value=""></option>'
                for (let i = 0; i < teamData.length; i++) {
                    domStr += '<option label="' + teamData[i].name + '" value="' + teamData[i].id + '"></option>'
                }
                $('#planModal #task_form_teamId').html(domStr)
            }
        }

        // 编辑 用户弹窗展示
        function showUserModal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.userList[index]
            pageInfo.handleType = 'EDITUSER'
            htmlUserOption()
            $('#userModal #modal_user_title').html('添加任务')
            $('#userModal #user_form_username').val(pageInfo.handRow.username)
            $('#userModal #user_form_realname').val(pageInfo.handRow.realName)
            $('#userModal #user_form_superAdmin').val(pageInfo.handRow.superAdmin)
            $('#userModal #user_form_phone').val(pageInfo.handRow.phone)
            $('#userModal #user_form_specialty').val(pageInfo.handRow.specialty)
            $('#userModal #user_form_awardInfo').val(pageInfo.handRow.awardInfo)
            $('#userModal #user_form_teamId').val(pageInfo.handRow.teamId)

            $('#userModal').modal()
        }

        // 添加 用户弹窗展示
        function showAddUserModal() {
            htmlUserOption()
            $('#userAddModal #modal_user_title').html('添加用户')
            $('#userAddModal #user_form_username').val('')
            $('#userAddModal #user_form_realname').val('')
            $('#userAddModal #user_form_superAdmin').val('')
            $('#userAddModal #user_form_phone').val('')
            $('#userAddModal #user_form_password').val('')
            $('#userAddModal #user_form_specialty').val('')
            $('#userAddModal #user_form_awardInfo').val('')
            $('#userAddModal #user_form_teamId').val('')

            $('#userAddModal').modal()
        }

        // 编辑 用户弹窗确定
        function editUserModalSubmit(btn) {
            var $btn = $(this);
            var params = {};
            var form_data = $('#modal_user_form').serializeArray()
                // 数据查验
            try {
                form_data.forEach(item => {
                    if (item.name == 'username' && !item.value) {
                        throw new Error('请输入账户！')
                    }
                    if (item.name == 'realName' && !item.value) {
                        throw new Error('请输入真实姓名！')
                    }
                    if (item.name == 'superAdmin' && !item.value) {
                        throw new Error('请选择账户权限！')
                    }
                    if (item.name == 'phone' && !item.value) {
                        throw new Error('请输入电话号码！')
                    }
                    if (item.name == "phone" && !(/^1[3456789]\d{9}$/.test(item.value))) {
                        throw new Error('请输入正确的电话号码！');
                    }
                    if (item.name == 'specialty' && !item.value) {
                        throw new Error('请输入特长！')
                    }
                    if (item.name == 'awardInfo' && !item.value) {
                        throw new Error('请输入获奖信息！')
                    }
                    if (item.name == 'teamId' && !item.value) {
                        throw new Error('请选择所属车队！')
                    }
                    params[item.name] = item.value
                })
                params.id = pageInfo.handRow.id
                    // params.createTime = new Date().getTime()

                handleEditUser($btn, params)
            } catch (data) {
                params = {}
                showToast({
                    msg: data + '' || '数据有误！',
                    icon: 'times',
                    type: 'danger'
                })
            }
        }

        // 添加 用户弹窗确定
        function addUserModalSubmit(btn) {
            var $btn = $(this);
            var params = {};
            var form_data = $('#modal_user_add_form').serializeArray()
                // 数据查验
            try {
                form_data.forEach(item => {
                    if (item.name == 'username' && !item.value) {
                        throw new Error('请输入账户！')
                    }
                    if (item.name == 'realName' && !item.value) {
                        throw new Error('请输入真实姓名！')
                    }
                    if (item.name == 'superAdmin' && !item.value) {
                        throw new Error('请选择账户权限！')
                    }
                    if (item.name == 'realName' && !item.value) {
                        throw new Error('请输入初始密码！')
                    }
                    // if (item.name == 'phone' && !item.value) {
                    //     throw new Error('请输入电话号码！')
                    // }
                    // if (item.name == "phone" && !(/^1[3456789]\d{9}$/.test(item.value))) {
                    //     throw new Error('请输入正确的电话号码！');
                    // }
                    // if (item.name == 'specialty' && !item.value) {
                    //     throw new Error('请输入特长！')
                    // }
                    // if (item.name == 'awardInfo' && !item.value) {
                    //     throw new Error('请输入获奖信息！')
                    // }
                    if (item.name == 'teamId' && !item.value) {
                        throw new Error('请选择所属车队！')
                    }
                    params[item.name] = item.value
                })
                params.avatar ? '' : params.avatar =
                    '//gw.alicdn.com/imgextra/i3/O1CN01QEaQlr1idHCLFlMXQ_!!6000000004435-55-tps-106-19.svg'

                handleAddUser($btn, params)
            } catch (data) {
                params = {}
                showToast({
                    msg: data + '' || '数据有误！',
                    icon: 'times',
                    type: 'danger'
                })
            }
        }
        // 删除 用户弹窗
        function deleteUserModal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.userList[index]
            $('#confirm_Modal #confirm_Modal_title').html('是否删除用户 ' + pageInfo.handRow.username + '?')
            pageInfo.handleType = 'DELETEUSER'
            $('#confirm_Modal').modal()
        }
        // 删除用户业务事件
        function handleDeleteUser($btn, id) {
            $btn.button("loading");
            // 执行删除操作
            $.ajax({
                type: 'DELETE',
                url: _apiUserDelete + id,
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: '删除成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        getAllList()
                        $('#confirm_Modal').modal('hide')
                    } else {
                        showToast({
                            msg: '删除失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: '删除失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })

        }
        // 编辑用户业务事件
        function handleEditUser($btn, params) {
            console.log(params)
            $btn.button("loading");
            _apiUserUpdate
            $.ajax({
                type: 'PUT',
                url: _apiUserUpdate,
                data: JSON.stringify(params),
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: '修改成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        getAllList()
                        $('#userModal').modal('hide')
                    } else {
                        showToast({
                            msg: '修改失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                        $('#userModal').modal('hide')
                    }

                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: '修改失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })
        }

        // 添加 用户业务事件
        function handleAddUser($btn, params) {
            $btn.button("loading");
            _apiUserUpdate
            $.ajax({
                type: 'POST',
                url: _apiUserSave,
                data: JSON.stringify(params),
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: '添加成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        getAllList()
                        $('#userAddModal').modal('hide')
                    } else {
                        showToast({
                            msg: '添加失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                        $('#userAddModal').modal('hide')
                    }

                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: '添加失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })
        }

        // select option
        function htmlUserOption() {
            const teamData = pageInfo.teamList
            if (teamData && teamData.length) {
                var domStr = ' <option label="请选择车队" value=""></option>'
                for (let i = 0; i < teamData.length; i++) {
                    domStr += '<option label="' + teamData[i].name + '" value="' + teamData[i].id + '"></option>'
                }
                $('#userModal #user_form_teamId').html(domStr)
                $('#userAddModal #user_form_teamId').html(domStr)
            }
        }


        // 编辑 车队弹窗
        function showTeamModal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.teamList[index]
            pageInfo.handleType = 'EDITTEAM'
            htmlTeamOption()
            $('#teamModal #modal_team_title').html('编辑车队')
            $('#teamModal #user_form_name').val(pageInfo.handRow.name)
            $('#teamModal #user_form_content').val(pageInfo.handRow.content)
            $('#teamModal #user_form_captain').val(pageInfo.handRow.captain)
            $('#teamModal').modal()
        }
        // 添加 车队弹窗
        function addTeamModal() {
            pageInfo.handleType = 'ADDTEAM'
            htmlTeamOption()
            $('#teamModal #modal_team_title').html('添加车队')
            $('#teamModal #user_form_name').val('')
            $('#teamModal #user_form_content').val('')
            $('#teamModal #user_form_captain').val('')
            $('#teamModal').modal()
        }
        // 添加/编辑 车队弹窗确认
        function editTeamModalSubmit(btn) {
            var $btn = $(this);
            var params = {};
            var form_data = $('#modal_team_form').serializeArray()
                // 数据查验
            try {
                form_data.forEach(item => {
                    if (item.name == 'name' && !item.value) {
                        throw new Error('请输入车队名称！')
                    }
                    if (item.name == 'content' && !item.value) {
                        throw new Error('请输入车队简介！')
                    }
                    // if (item.name == 'captain' && !item.value) {
                    //     throw new Error('请选择车队队长！')
                    // }
                    params[item.name] = item.value
                })
                if (!localStorage.getItem('userid')) {
                    setTimeout(function() {
                        location.href = './login.html'
                    }, 1000)
                    throw new Error('登录失效请重新登录！')
                }
                params.captain = localStorage.getItem('userid')
                params.createUser = localStorage.getItem('userid')
                params.createTime = new Date().getTime()

                handleEditTeam($btn, params)
            } catch (data) {
                params = {}
                showToast({
                    msg: data + '' || '数据有误！',
                    icon: 'times',
                    type: 'danger'
                })
            }

        }
        // 编辑/添加 车队业务事件
        function handleEditTeam($btn, params) {
            $btn.button("loading");
            let url, type, msg;
            if (pageInfo.handleType == 'ADDTEAM') {
                type = 'post'
                url = _apiTeamSave
                msg = "添加"
            } else {
                type = 'put'
                url = _apiTeamUpdate
                msg = "修改"
                params.id = pageInfo.handRow.id
                params.createTime = null
            }
            $.ajax({
                type: type,
                url: url,
                data: JSON.stringify(params),
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: msg + '成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        pageInfo.handleType = null
                        pageInfo.handRow = null
                        getAllList()
                        $('#teamModal').modal('hide')
                    } else {
                        showToast({
                            msg: msg + '失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: msg + '失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })
        }
        // 删除 车队弹窗
        function deleteTeamModal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.teamList[index]
            $('#confirm_Modal #confirm_Modal_title').html('是否删除车队 ' + pageInfo.handRow.name + '?')
            pageInfo.handleType = 'DELETETEAM'
            $('#confirm_Modal').modal()
        }
        // 删除车队业务事件
        function handleDeleteTeam($btn, id) {
            $btn.button("loading");
            // 执行删除操作
            $.ajax({
                type: 'DELETE',
                url: _apiTeamDelete + id,
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: '删除成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        pageInfo.handRow = null
                        pageInfo.handleType = null
                        getAllList()
                        $('#confirm_Modal').modal('hide')
                    } else {
                        showToast({
                            msg: '删除失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: '删除失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })


        }

        function htmlTeamOption() {
            const data = pageInfo.userList
            if (data && data.length) {
                var domStr = ' <option label="请选择车队队长" value=""></option>'
                for (let i = 0; i < data.length; i++) {
                    domStr += '<option label="' + data[i].username + '" value="' + data[i].id + '"></option>'
                }
                $('#teamModal #user_form_captain').html(domStr)
            }
        }

        // 加入车队 弹窗
        function joinTeamModal(e) {
            const index = $(e).attr('data-index')
            console.log(pageInfo.teamList[index])
            console.log(pageInfo.reViewList)
            if () {

            }
            return
            pageInfo.handRow = pageInfo.teamList[index]
            $('#confirm_Modal #confirm_Modal_title').html('是否加入车队《' + pageInfo.handRow.name + '》?')
            pageInfo.handleType = 'JOINTEAM'
            $('#confirm_Modal').modal()
        }

        // 加入车队 业务事件
        function handleJoinTeam($btn, id) {
            var params = {
                type: 1,
                teamId: id,
                status: 0,
                userId: localStorage.getItem('userid')
            }
            $.ajax({
                type: 'POST',
                url: _apiInfoReviewSave,
                data: JSON.stringify(params),
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: '加入成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        pageInfo.handRow = null
                        pageInfo.handleType = null
                        getAllList()
                        $('#confirm_Modal').modal('hide')
                    } else {
                        showToast({
                            msg: '加入失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: data || '加入失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })

        }

        // 退出车队 弹窗
        function quitTeamModal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.teamList[index]
            $('#confirm_Modal #confirm_Modal_title').html('是否退出车队《' + pageInfo.handRow.name + '》?')
            pageInfo.handleType = 'QUITTEAM'
            $('#confirm_Modal').modal()
        }

        // 退出车队 业务事件
        function handleQuitTeam($btn, id) {
            $.ajax({
                type: 'DELETE',
                url: _apiTeamDelete + id,
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: '退出成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        pageInfo.handRow = null
                        pageInfo.handleType = null
                        getAllList()
                        $('#confirm_Modal').modal('hide')
                    } else {
                        showToast({
                            msg: '退出失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: '退出失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })


        }



        // 添加 首页内容弹窗
        function showAddArticModal() {
            pageInfo.handleType = 'ADDARTIC'
            $('#articlModal #modal_articl_title').html('添加首页文章')
            $('#articlModal #articl_form_title').val('')
            $('#articlModal #articl_form_content').val('')
            $('#articlModal #articl_form_type').val('')

            $('#articlModal .articl_form_group_icon').addClass('hide')
            $('#articlModal .articl_form_group_url').addClass('hide')
            pageInfo.articlSelect = ''
            htmlAtrilFormItem(pageInfo)
            $('#articlModal').modal()
        }
        // 编辑 首页内容弹窗
        function showArticlModal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.articlList[index]
            pageInfo.handleType = 'EDITARTIC'
            $('#articlModal #modal_articl_title').html('编辑首页文章')
            $('#articlModal #articl_form_title').val(pageInfo.handRow.title)
            $('#articlModal #articl_form_content').val(pageInfo.handRow.content)
            $('#articlModal #articl_form_type').val(pageInfo.handRow.type)
            pageInfo.articlSelect = pageInfo.handRow.type
            htmlAtrilFormItem(pageInfo)
            $('#articlModal').modal()
        }
        // 添加/编辑 首页弹窗确认
        function editArticlModalSubmit(btn) {
            var $btn = $(this);
            var params = {};
            var form_data = $('#modal_articl_form').serializeArray()
            console.log(form_data)
                // 数据查验
            try {
                form_data.forEach(item => {
                    if (item.name == 'title' && !item.value) {
                        throw new Error('请输入标题！')
                    }
                    if (item.name == 'content' && !item.value) {
                        throw new Error('请输入内容！')
                    }
                    if (item.name == 'captain' && !item.value) {
                        throw new Error('请选择类型！')
                    }
                    if (item.name == 'icon' && !item.value) {
                        throw new Error(`请输入${pageInfo.articlSelect==4?'图片地址':'图标地址'}！`)
                    }
                    if (item.name == 'url' && !item.value) {
                        throw new Error('请输入链接url！')
                    }
                    params[item.name] = item.value
                })
                if (!localStorage.getItem('userid')) {
                    setTimeout(function() {
                        location.href = './login.html'
                    }, 1000)
                    throw new Error('登录失效请重新登录！')
                }
                params.createUser = localStorage.getItem('userid')
                    // params.createTime = new Date().getTime()
                handleEditArticl($btn, params)
            } catch (data) {
                console.log(data)
                params = {}
                showToast({
                    msg: data + '' || '数据有误！',
                    icon: 'times',
                    type: 'danger'
                })
            }

        }
        // 编辑/添加 首页内容业务事件
        function handleEditArticl($btn, params) {
            $btn.button("loading");
            let url, type, msg;
            if (pageInfo.handleType == 'ADDARTIC') {
                type = 'post'
                url = _apiInfoSave
                msg = "添加"
            } else {
                type = 'put'
                url = _apiInfoUpdate
                msg = "修改"
                params.id = pageInfo.handRow.id
                params.createTime = null
            }
            // 执行添加操作
            $.ajax({
                type: type,
                url: url,
                data: JSON.stringify(params),
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                            msg: msg + '成功！',
                            icon: 'check',
                            type: 'success'
                        })
                        $('#articlModal').modal('hide')
                        pageInfo.handleType = null
                        pageInfo.handRow = null
                            // 刷新列表
                        getAllList()
                    } else {
                        showToast({
                            msg: msg + '失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                        $('#articlModal').modal('hide')
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: msg + '失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })
        }
        // 删除 文章弹窗
        function deleteArticlModal(e) {
            const index = $(e).attr('data-index')
            pageInfo.handRow = pageInfo.articlList[index]
            $('#confirm_Modal #confirm_Modal_title').html('是否删除文章 ' + pageInfo.handRow.title + '?')
            pageInfo.handleType = 'DELETARTICL'
            $('#confirm_Modal').modal()
        }
        // 删除车队文章业务事件
        function handleDeleteArtic($btn, id) {
            $btn.button("loading");
            // 执行删除操作
            $.ajax({
                type: 'DELETE',
                url: _apiInfoDelete + id,
                contentType: "application/json",
                dataType: 'json',
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                success: function(data) {
                    $btn.button("reset");
                    if (data) {
                        showToast({
                                msg: '删除成功！',
                                icon: 'check',
                                type: 'success'
                            })
                            // 刷新列表
                        pageInfo.handRow = null
                        pageInfo.handleType = null
                        getAllList()
                        $('#confirm_Modal').modal('hide')
                    } else {
                        showToast({
                            msg: '删除失败！' + data,
                            icon: 'info',
                            type: 'danger'
                        })
                    }
                },
                error: function(e) {
                    const data = JSON.parse(e.responseText)
                    $btn.button("reset");
                    showToast({
                        msg: '删除失败！',
                        icon: 'times',
                        type: 'danger'
                    })
                }
            })



        }

        // 首页弹窗里icon  url 赋值初始化
        function htmlAtrilFormItem(data) {
            // 赋值
            let icon = '',
                url = '',
                v = pageInfo.articlSelect;
            if (data.handleType == 'EDITARTIC') {
                icon = data.handRow.icon
                url = data.handRow.url
            }
            $('#articlModal .articl_form_group_icon').remove()
            $('#articlModal .articl_form_group_url').remove()
            if (v == 4 || v == 5) {
                var domStr = `<div class="form-group articl_form_group_icon">
                                <label for="articl_form_icon" class="col-sm-2">${v==4?'图片地址':'图标地址'}</label>
                                <div class="col-sm-10">
                                    <input value="${icon}" name="icon" id="articl_form_icon" type="text" class="form-control" placeholder="请输入${v==4?'图片地址':'图标地址'}"/>
                                </div>
                            </div>
                            <div class="form-group articl_form_group_url">
                                <label for="articl_form_url" class="col-sm-2">链接url</label>
                                <div class="col-sm-10">
                                    <input value="${url}" name="url" id="articl_form_url" type="text" class="form-control"  placeholder="请输入链接url" />
                                </div>
                            </div>`
                $('#articlModal #modal_articl_form').append(domStr)
            }
        }
    </script>
</body>

</html>